---
title: Unity Custom SRP 基础（三）
date: 2025-01-07 20:43:16
categories: 
  - [图形学]
  - [unity, pipeline]
tags:
  - 图形学
  - 游戏开发
  - unity
top_img: /images/black.jpg
cover: https://s2.loli.net/2025/01/14/ELDF7wHpCPn2mKM.gif
mathjax: true
description: 本笔记的主要内容有XXXXXXXXXXXXXXXXXXXXXXXXXX。
---

> 本笔记是关于 Unity 的**自定义可编程渲染管线**的入门基础，即 **SRP (Scriptable Rendering Pipeline)**，主要参考了著名的教程 https://catlikecoding.com/ 的 Custom SRP Tutorial，以及知乎上各位图形学大神们的文章。  
>    
> 笔者使用的 Unity 版本是 6000.0.27f1，Core RP Library 的版本是 17.0.3。

# 烘焙光照
这一章节主要讲的就是 Unity 的**离线烘焙 Lightmap 系统**，即 **Progressive Lightmapper**，以及如何将我们的 SRP 和该系统结合在一起，该系统同时会烘焙光照探针 light probe 和反射探针 reflection probe。而 Unity 的**实时 Lightmap 系统**，即 **Enlighten** 系统，Unity 对其的说明是，它只适用于缓慢移动的光照，比如太阳在天空中的移动，不适用于变化特别快的光照，因为 Enlighten 在 CPU 上的计算造成了一定的性能瓶颈，只适合较为高端的设备使用。在 catlikecoding 的教程中没有将 Enlighten 系统融合进 SRP，故我这里也不做详细说明。

我们知道 Lightmap 是**全局光照 Global Illumination** 的离线实现方式，而全局光照的实现包括直接光漫反射、直接光镜面反射、间接光漫反射以及间接光镜面反射。直接光漫反射和直接光镜面反射之前实现了一部分，即方向光的实现。间接光漫反射的实现，可以采用 Skybox 的球谐函数（即 IBL 的漫反射部分）、Lightmap 或者光照探针 light probe，这就是本章节的内容。而间接光镜面反射，则采用 Spilt sum approximation 的方式，要么采样预过滤的 Skybox，要么采样预过滤的反射探针 reflection probe，这个在之后的章节中实现。

我在之前的文章 [IBL 基于图像的光照（二）](https://ybniaobu.github.io/2024/08/16/2024-08-16-IBL_Basics2/#Unity-URP-%E7%9A%84-IBL-%E5%AE%9E%E7%8E%B0) 的 Unity URP 的 IBL 实现章节中有大致说明过 URP 如何实现 Lightmap。我会略微修改 URP 的实现方式，使其更适配我选用的 PBR 模型以及之前 IBL 的相关知识，之后会详细说明。

## Lighting Settings
