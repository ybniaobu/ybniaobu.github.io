---
title: 《C#图解教程》读书笔记（一）
date: 2022-10-28 09:42:57
categories: 
  - [C#, C#读书笔记]
tags:
  - .net
  - C#
  - 读书笔记
cover: https://s2.loli.net/2022/10/28/YztgSrJ6BTOWRLU.jpg
---

> 该笔记为 **《C#图解教程》** 的读书笔记，未经过系统的整理；  
> 学习完成日期为XXXX年XX月XX日。  
> 本篇主要内容为：XXXXXXXXXXXXXXXXXXXXXXX

<div  align="center">  
<img src="https://s2.loli.net/2022/10/31/VLR94de6aqA3WPw.jpg" width = "80%" height = "80%" alt="C#图解教程"/>
</div>

# 第一章 C#和.NET框架
## .NET框架的组成
.NET框架（.NET Framework）由三个部分组成：

<div  align="center">  
<img src="https://s2.loli.net/2022/10/31/sjP4eQIFqxNv65C.png" width = "30%" height = "30%" alt=".NET框架的组成"/>
</div>

执行环境称为**CLR**（Common Language Runtime 公共语言运行库）；CLR管理程序的执行，包括内存管理和垃圾收集（GC garbage collector 垃圾收集器）；代码安全验证；代码执行、线程管理及异常处理。

严格来说，.NET框架由**CLR**和**FCL**（Framework Class Library 框架类库）组成，FCL是BCL的超集。

**BCL**（Base Class Library 基类库）是.NET框架使用的一个大的类库。包括通用基础类：比如文件操作、字符串操作、安全和加密；集合类：实现了列表、字典、散列表（hash tables）以及位数组（bit arrays）；线程和同步类：用于创建多线程程序；XML类：用于创建、读取及操作XML文档。

> 以下内容摘《C#播放器指南》一书。  
> 
> BCL包含所有的内置类型、数组、异常、数学库、基本文件I/O、安全性、集合、反射、联网、字符串操作、线程等等。一般规则是任何以System开头的名称空间都是BCL的一部分。
> 
> 除了BCL之外，微软还随.NET框架提供了更多的类。通常，这些附加内容涵盖了广泛的功能领域，例如数据库访问或图形用户界面(Windows窗体或WPF)。包括BCL在内的整个集合被称为框架类库FCL。

## 编译为CIL
.NET语言的解释器接受源代码文件，并生成名为**程序集Assembly**的输出文件：

<div  align="center">  
<img src="https://s2.loli.net/2022/10/31/Q9dpN3izqSuKmGD.png" width = "45%" height = "45%" alt="编译过程"/>
</div>

**程序集**中的代码不是本机代码，而是**CIL**（Common Intermediate Language 公共中间语言）

程序集的信息中包括：程序的CIL；程序中使用的类型的元数据（Metadata）；对其他程序集引用的元数据。

## 编译成本机代码（Native Code）并执行
程序的CIL直到被调用运行时才会被编译成本机代码。在运行时，CLR执行以下步骤：  
（1）检查程序集的安全特性；  
（2）在内存中分配空间；  
（3）把程序集中的可执行代码发给即时编译器（just-in-time JIT compiler），把其中一部分编译成本机代码。

<div  align="center">  
<img src="https://s2.loli.net/2022/10/31/AtdGz26FTm4voMn.png" width = "40%" height = "40%" alt="运行时被编译成本机代码"/>
</div>

程序集中的可执行代码只有在被需要时由JIT编译器编译，然后就被缓存cache起来以备在后来的程序中执行。这意味着不被调用的代码不会被编译成本机代码，而且被调用到的代码只被编译一次。

一旦CIL被编译成本机代码，CLR就在运行时管理它，执行如释放无主内存、检查参数类型、管理异常等任务。在CLR控制之下的代码称为托管代码（managed code）；而不在CLR控制之下运行的代码为非托管代码。

## CLR
.NET框架的核心组件是**CLR**，它在操作系统顶层，负责管理程序的执行：

<div  align="center">  
<img src="https://s2.loli.net/2022/11/01/iltGr4vmNuyMsA1.png" width = "50%" height = "50%" alt="CLR概览"/>
</div>

CLR还通过访问BCL得到广泛的编程功能，包括如Web服务和数据服务之类的功能。

## CLI
每种编程语言都有一组内置的类型，包括整数、浮点数和字符等对象。但是这些类型因为编程语言和平台的不同而不同，这种缺乏统一性需要一组标准促进有序协作。

**CLI**（Common Language Infrastructure 公共语言基础结构）就是一组标准，它把.NET框架的所有组件连结成了一个系统。

<div  align="center">  
<img src="https://s2.loli.net/2022/11/01/Qq9xHIoUvszDgZh.png" width = "55%" height = "55%" alt="CLI组成"/>
</div>

1. 公共类型系统  
**CTS**（Common Type System 公共类型系统），它定义了一组内置类型；.NET兼容编程语言提供的类型通常映射到CTS已定义的内置类型集的某个特殊子集；***CTS让所有类型都继承自公共的基类——object***；CTS确保用户定义的类型和系统类型能够被任何.NET兼容的语言使用。

2. 公共语言规范  
**CLS**（Common Language Specification 公共语言规范）详细说明了.NET兼容编程语言的规则、属性和行为，包括数据类型、类结构和参数传递）。


# 第二章 C#和.NET Core
## .NET Core的由来
为了更好地解决Web开发以及Linux或macOS的开发，微软用.NET框架搭建了一个基于云的、跨平台的、开源衍生产品，这个新框架即 **.NET Core**。微软也收购了Xamarin以解决Android和IOS等移动平台的开发问题。

<div  align="center">  
<img src="https://s2.loli.net/2022/11/01/UBiFr2XZNK4nJuE.png" width = "70%" height = "70%" alt=".NET生态系统"/>
</div>

.NET Core主要目标为多平台支持；快速开发和升级；更小的应用程序占用空间；更简单的部署；更少的版本问题；开源社区的支持；改进的应用程序性能。


# 第三章 C#编程概述
## 一个简单的C#程序
``` C#
using System;

namespace Simple
{
    class Program   // declare a class
    {
        static void Main()
        {
            Console.WriteLine("Hi there!");
        }
    }
}
```

行1 ：告诉编译器这个程序使用**System命名空间**的类型；  
行3 ：声明新的名为**Simple的命名空间**，在这部分声明的任何类型都是该命名空间的成员（第4行到第12行）；  
行5 ：声明新的名为**Program的类类型**，在这部分声明的任何成员都是组成这个类的成员（第6行到第11行）；  
行7 ：声明一个名称为**Main的方法**作为**类Program**的成员，**Main是一个特殊函数**，编译器用它作为程序的起始点；  
行9 ：包含了一条简单的语句，组成了**Main的方法**：简单语句以一个分号结束，这条语句使用**命名空间System**中的一个名为**Console的类**将消息输出到屏幕窗口，若没有第一条的**using语句**，编译器就不知道在哪里寻找**类Console**。

*C#程序由一个或多个类型声明组成，命名空间是与某个名称相关联的一组类型声明*。上述代码创建了一个名称为Simple的新命名空间，并在其中声明了其类型（类Program），还使用了System命名空间中定义的Console类。


> ***补充 ：使用 Visual Studio Code 创建 .NET 控制台应用程序（摘自官方.NET文档）***
> 
> **先决条件**：.NET 6 SDK以及已安装 C# 扩展 的 Visual Studio Code
> 
> **创建应用**：  
> 1、在合适位置创建文件夹，并打开vscode打开该文件夹。默认情况下，文件夹名称将是项目名称和命名空间名称；  
> 2、在vscode中选择Terminal - New Terminal；  
> 3、在“终端”中输入以下命令：`dotnet new console --framework net6.0`；  
> 4、此时创建了一个在控制台窗口中显示“Hello World”的简单应用程序：
> ``` C#
> Console.WriteLine("Hello, World!");
> ```
> 
> 首次创建程序时，Visual Studio Code 会提示添加缺少的资产，以生成和调试应用。 选择“是”，Visual Studio Code 会创建一个包含“launch.json”和“tasks.json”文件的“.vscode”文件夹。
> 
> <div  align="center">  
> <img src="https://s2.loli.net/2022/11/04/qmQSHOwfJIvMb8Y.png" width = "55%" height = "55%"/>
> </div>
> 
> 如果未收到提示，或者意外将其关闭而未选择“是”，可以按如下操作步骤：
> 
> <div  align="center">  
> <img src="https://s2.loli.net/2022/11/04/PtDE7zaYQeFGokC.png" width = "35%" height = "35%"/>
> </div>
> 
> 也可以从菜单中选择Run - Add Configurations，在“选择环境”提示符下，选择“.NET 5+ 和 .NET Core”。
> 总之最后要见到 .vscode 中的 launch.json 和 tasks.json 文件。
> 
> **运行应用**：  
> 在“终端”中运行以下命令：`dotnet run`  
> 程序显示“Hello World!”并终止。


## 标识符 Identifiers
**标识符**是用于命名的字符串。  

某些字符能否在标识符的特定位置出现是有规定的：
  - 字母和下划线可以出现在任何位置；
  - 数字不能放在首字母，但可以出现在其他任何位置；
  - @字符只能放在标识符的首位，不推荐将@作为常用字符。

标识符区分大小写，比如变量名myVar和MyVar是不同的标识符。第8章将介绍推荐的C#命名约定。

## 关键字 Keywords
**关键字**不能作为标识符，除非以@字符开始。  
所有C#关键字全部都以小写字母组成。

*表：C#关键字*
| |||||||
| :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| abstract | const | extern | int | out | short | typeof |
| as | continue | false | interface | override | sizeof | uint |
| base | decimal | finally | internal | params | stackalloc | ulong |
| bool | default | fixed | is | private | static | unchecked |
| break | delegate | float | lock | protected | string | unsafe |
| byte | do | for | long | public | struct | ushort |
| case | double | foreach | namespace | readonly | switch | using |
| catch | else | goto | new | ref | this | virtual |
| char | enum | if | null | return | throw | void |
| checked | event | implicit | object | sbyte | true | volatile |
| class | explicit | in | operator | sealed | try | when while |

**上下文关键字 Contextual Keywords**是仅在特定的语言结构中充当关键字的标识符，上下文关键字可以在代码的其他部分被用作标识符。

*表：C#的上下文关键字*
| |||||||
| :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| add | ascending | async | await | by | descending | dynamic |
| equals | from | get | global | group | in | into |
| join | let | on | orderby | partial | remove | select | 
| set | value | var | where | yield | | | 

## Main：程序的起始点  
每个C#程序必须有一个类带有**Main方法(函数)**。
  - 每个C#程序的可执行起始点在Main中的第一条指令；
  - Main必须首字母大写。

``` C#
static void Main( )
{
    Statements
}
```

## 空白 Whitespace
程序中的空白指没有可视化输出的字符。在源代码中使用的空白会被编译器忽略。

空白字符包括：空格(Space)；制表符(Tab)；换行符(New line)；回车符(Carriage return)

比如，下面的代码会被编译器同等对待：

``` C#
Main()
{
    Console.WriteLine("Hi, there!");
}
// 连在一起
Main(){Console.WriteLine("Hi, there!");}
```

## 语句 Statements
此处为简单介绍，详细见第10章。

**简单语句**以一个**分号**结束，下面的代码即2条简单语句组成的序列：
``` C#
int var1 = 5;
System.Console.WriteLine("The value of var1 is {0}", var1);
```

## 块 Blocks
**块**是一个由成对大括号包围的0条或多条语句序列，它在语法上相当于一条语句。
``` C#
{
    int var1 = 5;
    System.Console.WriteLine("The value of var1 is {0}", var1);
}
```
语法上只需要一条语句，若需要执行的动作无法用一条简单语句表达时，考虑用块；  
有些特定的程序结构只能使用块；  
简单语句以分号结束，块后面不跟分号。

## 从程序中输出文本
**控制台窗口console window**是一种简单的命令提示窗口。BCL提供了一个名为Console的类（在System命名空间中），该类包含了讲数据输入和输出到控制台窗口的方法。

### Write
Write是Console类的成员，示例：
``` C#
System.Console.Write ("This is text1. ");
System.Console.Write ("This is text2. ");
System.Console.Write ("This is text3. ");
```
在控制台窗口输出如下：
``` Console
This is text1. This is text2. This is text3.
```

注意：Write没有在字符串后面添加换行符，所以三个语句都输出在同一行。

### WriteLine
WriteLine也是Console类的成员，但会在每个输出字符串的结尾添加一个换行符。

上面的代码用WriteLine替换掉Write，输出会变为多行：  
``` Console
This is text1.
This is text2.
This is text3.
```

### 格式字符串 The Format String
Write或WriteLine语句可以有一个以上的参数，格式如下：  
`Console.WriteLine( FormatString, SubVal0, SubVal1, SubVal2, ... );`

第一个参数必须总是字符串，称为**格式字符串**；格式字符串可以包括**代替标记Substitution markers**。代替标记包含大括号和一个整数，整数就是替换值的数字位置。

例如：下面的语句有2个替代标记，{0}和{1}；以及2个替换值，即3和6。
``` C#
Console.WriteLine("Two sample integers are {0} and {1}.", 3, 6);
```
C# 6.0 还引入了**字符串插值string interpolation**，前提是前面加上$符号：
``` C#
int var1 = 3;
int var2 = 6;
Console.WriteLine($"Two sample integers are {var1} and {var2}.");
```

### 多重标记和值
可以使用任意数量的替代标记和任意数量的值，比如：
``` C#
Console.WriteLine("Three integers are {1}, {0} and {1}.", 3, 6);
```
但标记不能引用超出替换值列表长度的值，如果引用，不会产生编译错误compile error，但会产生运行错误runtime error（称为**异常exception**）。比如：`Console.WriteLine("Two integers are {0} and {2}.", 3, 6);`中位置2不存在，3是位置0，6是位置1。

### 格式化数字字符串
指定数字格式，例如：
``` C#
Console.WriteLine("The value: {0}." , 500);
Console.WriteLine("The value: {0:C}.", 500); // 格式化为货币

int myInt = 500;
Console.WriteLine($"The value: {myInt}.");
Console.WriteLine($"The value: {myInt:C}.");
```
上述2种代码，都在控制台窗口产生同样输出：
``` Console
The value: 500.
The value: ￥500.00.
```
大括号内的**格式说明符format specifier**的语法由三个字段fields组成：**索引号index或者字符串插值变量string interpolation variable**、**对齐说明符alignment specifier**和**格式字段format field**。

语法为：`{ index,alignment:format }`

*index或string interpolation*：必需项，指定列表中的某一项；  
*alignment*：可选，指定字段宽度，以及是否是左对齐或是右对齐；  
*format*：可选，指定项的格式。  
*注意*：对齐前面是逗号，格式前面是冒号。

***（1）对齐说明符***  
由一个正整数或者负整数组成：*整数表示字段使用字符的最少数量*；符号表示右对齐或左对齐，*正数表示右对齐，负数表示左对齐*。
``` C#
int myInt = 500;
Console.WriteLine("|{0, 10}|", myInt); // 右对齐Aligned right
Console.WriteLine("|{0,-10}|", myInt); // 左对齐Aligned left
```
输出如下，在两个竖杠的中间有10个字符：
``` Console
|       500|
|500       |
```
*如果要表示的字符数比对齐说明符指定的字符数少，那么其余字符会使用空格填充*；  
*如果要表示的字符数多于指定的字符数，对齐说明符会被忽略，并且使用所需的字符进行表示*。

***（2）格式字段***  
格式字段有三部分，①**冒号**后面必须紧跟格式说明符，中间不能有空格；②**格式说明符format specifier**是一个字母字符，是9个内置字符格式之一，可以是大写或者小写；③**精度说明符precision specifier**是可选的，由1~2位数字组成，实际意义取决于格式说明符。

语法为：`:Axx`，A为格式说明符，xx为精度说明符。
``` C#
double myDouble = 12.345678;
Console.WriteLine("{0,-10:G} -- General", myDouble);
Console.WriteLine("{0,-10} -- Default, same as General", myDouble);
Console.WriteLine("{0,-10:F4} -- Fixed Point, 4 dec places", myDouble);
Console.WriteLine("{0,-10:C} -- Currency", myDouble);
Console.WriteLine("{0,-10:E3} -- Sci. Notation, 3 dec places", myDouble);
Console.WriteLine("{0,-10:x} -- Hexadecimal integer", 1194719 );
```
输出如下：
``` Console
12.345678  -- General
12.345678  -- Default, same as General
12.3457    -- Fixed Point, 4 dec places
￥12.35     -- Currency
1.235E+001 -- Sci. Notation, 3 dec places
123adf     -- Hexadecimal integer
```

***（3）标准数字格式说明符***  
9种标准数字格式说明符，若说明符会根据大小写会有不同输出，会标注为区分大小写。

| 名字和字符 | 意义 |
| :---- | :---- |
| 货币Currency<br>C、c | 使用货币符号，货币符号取决于程序所在PC的区域设置<br>精度说明符：小数位数<br>示例：`Console.WriteLine("{0 :C}", 12.5);`<br>输出：￥12.50 |
| 十进制数Decimal<br>D、d | 十进制数字字符串，可以有负数符号。只能和整数类型配合使用<br>精度说明符：输出字符串的最小位数，若实际数字位数少，则左边以0填充<br>示例：`Console.WriteLine("{0 :D4}", 12);`<br>输出：0012 |
| 定点Fixed-point<br>F、f | 带有小数点的十进制数字字符串，可以有负数符号。<br>精度说明符：小数位数<br>示例：`Console.WriteLine("{0 :F4}", 12.3456789);`<br>输出：12.3457 |
| 常规General<br>G、g | 在没有指定说明符的情况下，会根据值转换为定点或科学计数法表示的形式<br>精度说明符：根据值的情况<br>示例：`Console.WriteLine("{0 :G4}", 12.3456789);`<br>输出：12.35 |
| 十六进制数Hexadecimal<br>X、x<br>区分大小写 | 十六进制数字字符串。A~F会匹配说明符的大小写<br>精度说明符：输出字符串的最小位数，若实际数字位数少，则左边以0填充<br>示例：`Console.WriteLine("{0 :x}", 180026);`<br>输出：2bf3a |
| 数字Number<br>N、n | 和定点表示法相似，但是每3个数字的一组中间有逗号或空格分隔符，使用哪个看程序所在PC的区域设置<br>精度说明符：小数位数<br>示例：`Console.WriteLine("{0 :N2}", 12345678.54321);`<br>输出：12,345,678.54 |
| 百分比Percent<br>P、p | 表示百分比的字符串，数字会乘以100<br>精度说明符：小数位数<br>示例：`Console.WriteLine("{0 :P2}", 0.1221897);`<br>输出：12.22% |
| 往返过程Round-trip<br>R、r | 保证输出字符串后如果使用Parse方法将字符串转化为数字，Parse方法在第27章<br>精度说明符：忽略<br>示例：`Console.WriteLine("{0 :R}", 1234.21897);`<br>输出：1234.21897 |
| 科学计数法Scientific<br>E、e<br>区分大小写 | 具有尾数和指数的科学计数法，e的大小写和说明符一致<br>精度说明符：小数位数<br>示例：`Console.WriteLine("{0 :e4}", 12.3456789);`<br>输出：1.2346e+001 |

## 注释：为代码添加注解 Comments: Annotating the Code
**单行注释 Single-line comments** ：`//`，注释范围一直到行结束都有效。

**带分隔符的注释 Delimited comments** ：开始标记`/*`和结束标记`*/`，带分隔符的注释可以跨越多行，或者只包括行的一部分。注释范围一直到第一个结束分隔符都有效。

**文档注释 Documentation Comments** ：`///`，在第27章阐述。文档注释包括XML文档，可以用于产生程序文档。


# 第四章 类型、存储和变量
## C#程序是一组类型声明
C程序是一组函数和数据类型，C++程序是一组函数和类，C#程序或DLL是一组类型声明。

(1) 类型声明中必须有一个包含**Main方法**的类；  
(2) **命名空间**将相关的类型声明分组并命名，所以在命名空间内声明程序类型。

``` C#
namespace MyProgram // Declare a namespace，名为MyProgram.
{
    DeclarationOfTypeA // Declare a type.
    DeclarationOfTypeB // Declare a type.

    class C // Declare a type.
    {
        static void Main()
        {
            ...
        }
    }
}
```
命名空间在第22章详细阐述。

## 类型是一种模板
类型可以理解为一个创建数据结构的模板。类型具有以下元素：名称、用于保存的数据结构、一些行为和约束条件。

比如：short类型，名称是short，结构是2字节，行为是16位整数。int类型，名称是int，结构是4字节，行为是32位整数。

## 实例化类型 Instantiating a Type
从类型模板创建对象，即**实例化**该类型。

通过实例化类型而创建的对象被称为类型的**对象**或类型的**实例**。这2术语可以互换。

## 数据成员和函数成员
**简单类型**如short、int和long，只能存储一个数据项；
数组类型（array）可以存储多个同类型的数据项，这些数据项即**数组元素**。

然而有些类型可以包含不同类型的数据项，这些数据项被称为**成员 members**，包括**数据成员**和**函数成员**：**数据成员**保存了与这个类的对象或整个类相关数据；**函数成员**执行代码，定义类型的行为。

## 预定义类型
C#有16种预定义类型，包括13种**简单类型**和3种**非简单类型**。所有预定义类型的名称都是小写。

简单类型可以分为3类：
- 11种数值类型：
    - 不同长度的有符号和无符号*整数类型*；
    - *浮点数类型*float和double；
    - *高精度小数类型*decimal，与float和double不同，decimal类型可以表示分数，常用于货币计算。
- *Unicode字符类型*char；
- *布尔类型*bool，即true和false。

3种非简单类型为：
- string，一个Unicode字符数组；
- object，所有类型的基类；
- dynamic，使用动态语言编写的程序集使用。

<div  align="center">  
<img src="https://s2.loli.net/2022/11/16/pKUunxX9i5ayjqt.png" width = "60%" height = "60%" alt="预定义类型"/>
</div>

所有预定义类型都映射到底层的.NET类型。*预定义简单类型*都表示一个单一的数据项，如下表：

| 名称 | 含义 | 范围 | .NET框架类型 | 默认值 |
| :---- | :---- | :---- | :---- | :---- |
| sbyte | 8-bit signed integer | -128 to 127 | System.SByte | 0 |
| byte | 8-bit unsigned integer | 0 to 255 | System.Byte | 0 |
| short | 16-bit signed integer | -32,768 to 32,767 | System.Int16 | 0 |
| ushort | 16-bit unsigned integer | 0 to 65,535 | System.UInt16 | 0 |
| int | 32-bit signed integer | -2,147,483,648 to 2,147,483,647 | System.Int32 | 0 |
| uint | 32-bit unsigned integer | 0 to 4,294,967,295 | System.UInt32 | 0 |
| long | 64-bit signed integer | -9,223,372,036,854,775,808 to 9,223,372,036,854,775,807 | System.Int64 | 0 |
| ulong | 64-bit unsigned integer | 0 to 18,446,744,073,709,551,615 | System.UInt64 | 0 |
| float | Single-precision float | 1.5×10^-45 to 3.4×10^38 | System.Single | 0.0f |
| double | Double-precision float | 5×10^-324 to 1.7×10^308 | System.Double | 0.0d |
| bool | Boolean | true, false | System.Boolean | false |
| char | Unicode character | U+0000 to U+ffff | System.Char | \x0000 |
| decimal | Decimal value with 28-significant-digit precision | ±1.0×10^28 to ±7.9×10^28 | System.Decimal | 0m |

*预定义非简单类型*，如下表：
| 名称 | 含义 | .NET框架类型 |
| :---- | :---- | :---- |
| object | The base class from which all other types, including the simple types are derived | System.Object |
| string | A sequence of zero or more Unicode characters | System.String |
| dynamic | A type designed to be used with assemblies written in dynamic languages | No corresponding .NET type |

## 用户定义的类型
