---
title: 《C#图解教程》读书笔记（五）
date: 2023-07-07 14:09:57
categories: 
  - [C#, C#读书笔记]
tags:
  - .net
  - C#
  - 读书笔记
top_img: /images/black.jpg
cover: https://s2.loli.net/2022/12/15/TYXrac2oJnPlM1E.png
---

> 该笔记为 **《C#图解教程》** 的读书笔记，读书笔记仅为知识的记录，方便后续查找；  
> 学习完成日期为XXXX年XX月XX日。  
> 本篇主要内容为：XXXXXXXXXXXXXXXX 。

<div  align="center">  
<img src="https://s2.loli.net/2022/10/31/VLR94de6aqA3WPw.jpg" width = "80%" height = "80%" alt="C#图解教程"/>
</div>

# 第二十四章 预处理指令
## 什么是预处理指令
源代码指定了程序的定义，**预处理指令 preprocessor directive** 指示编译器如何处理源代码。例如，在某些情况下，我们可能希望编译器忽略一部分代码，而在其他情况下，我们可能希望代码被编译。预处理指令给了我们这样的选项。

在 C 和 C++ 中有实际的预处理阶段，此时预处理程序遍历源代码并且为之后的编译阶段准备文本输出流。在 C# 中没有实际的预处理程序。“预处理”指令由编译器来处理，而这个术语保留了下来。

## 基本规则
下面是预处理指令最重要的一些语法规则：  
①预处理指令必须和 C# 代码在不同的行；  
②与 C# 语句不同，预处理指令不需要以分号结尾；  
③包含预处理指令的每一行必须以#字符开始：
&emsp;&emsp;- 在#字符前可以有空格；  
&emsp;&emsp;- 在#字符和指令之间可以有空格。
④允许行尾注释；  
⑤在预处理指令所在的行不允许分隔符注释。

``` C#
#define PremiumVersion     //没有分号，正确
  #define BudgetVersion    //前面有空格，正确
# define MediumVersion     //中间有空格，正确

#define PremiumVersion     /* all bells & whistles */ 不允许分隔符注释，错误

#define BudgetVersion      // Stripped-down version 允许行尾注释，正确
```

下表列出了预处理指令：

| 指令 | 含义概要 |
| :---- | :---- |
| #define identifier | 定义编译符号 |
| #undef identifier | 取消定义编译符号 |
| #if expression | 如果表达式是true，则编译器编译下面的片段 |
| #elif expression | 如果表达式是true，则编译器编译下面的片段 |
| #else | 如果之前的#if或#elif表达式是false，则编译器编译下面的片段 |
| #endif | 标记一个#if结构的结束 |
| #region name | 标记一段代码的开始，没有编译效果 |
| #endregion name | 标记一段代码的结束，没有编译效果 |
| #warning message | 显示编译时的警告消息 |
| #error message | 显示编译时的错误消息 |
| #line indicator | 修改在编译器消息中显示的行数 |
| #pragma warning | 提供修改编译器警告消息行为的选项 |

## `#define` 和 `#undef` 指令
**编译符号 compilation symbol** 是只有两种可能状态的标识符，要么被定义，要么未被定义。编译符号有如下特性：  
①它可以是除了 true 或 false 以外的任何标识符，包括 C# 关键字，以及在 C# 代码中声明的标识符，这两者都是可以的；  
②它没有值。与 C 和 C++ 不同，它不表示字符串。

`#define` 和 `#undef` 指令只能用在源文件的第一行，也就是任何 C# 代码之前。在 C# 代码开始后，`#define` 和 `#undef` 指令就不能再使用。编译符号的范围被限制于单个源文件。只要编译符号在任何 C# 代码之前，重复定义已存在的编译符号也是允许的。

定义一个标识符相当于将其值设置为 true。取消定义一个标识符相当于将其值设置为 false。尽管必须在 C# 代码之外定义标识符，但可以在 C# 代码中使用它，通常是在 `#if #else` 构造中使用，如下：

``` C#
#define debug
static void Main()
{
    #if debug
        //开启详细日志
    #else
        //性能优化
    #endif
        ...
}
```

## 条件编译
条件编译允许根据某个编译符号是否被定义标注一段代码被编译或跳过。

有4个指令可以用来指定条件编译：`#if`; `#else`; `#elif`; `#endif`。

在`#if`和`#elif`指令中使用的条件是一个返回 true 或 false 的简单表达式，如下表所总结的。条件可以由单个编译符号、符号表达式或操作符组成；子条件可以使用圆括号分组；文本 true 或 false 也可以在条件表达式中使用：

| 参数类型 | 意义 | 运算结果 |
| :---- | :---- | :---- |
| 编译符号 | 使用`#define`指令定义（或未被定义）的标识符 | true：如果符号已经使用`#define`指令定义 <br> false：其他 |
| 表达式 | 使用符号和操作符!、==、!=、&&、&#9474;&#9474;构建的 | true：如果表达式运算结果为true <br> false：其他 |

条件编译示例如下：  

``` C#
#if !DemoVersion //表达式
    …
#endif

#if(LeftHanded && OemVersion) //完整版
    …
#endif

#if true //下面的代码片段总是会被编译
    …
#endif
```

## 条件编译结构
`#if` 和 `#endif` 指令在条件编译结构中需要配对使用。