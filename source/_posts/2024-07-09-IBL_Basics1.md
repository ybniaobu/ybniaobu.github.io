---
title: IBL 基于图像的光照（一）
date: 2024-07-09 15:25:54
categories: 
  - [图形学]
tags:
  - 图形学
  - 游戏开发
top_img: /images/black.jpg
cover: https://s2.loli.net/2024/07/09/TlFKUBzxHNSGs2q.jpg
mathjax: true
description: 本笔记的主要内容有 XXXXXXXXXXXXXX
---

> 本篇文章主要参考了著名的 LearnOpenGL 教程：https://learnopengl-cn.github.io/ 或 https://learnopengl.com/ 以及谷歌的 Filament PBR 白皮书：https://google.github.io/filament/Filament.md.html#materialsystem/diffusebrdf 。

# Image based lights (IBL) 介绍
## 前言
在之前的文章 PBR 理论基础（BRDF）有提到过，对于一个点光源来说，当我们为一个表面上的特定的点 $\,p\,$ 着色时，在其半球领域 $\,\Omega\,$ 的所有可能的入射方向上，只有一个入射方向向量 $\,\omega_i\,$ 直接来自于该点光源。

在实现上来说，对于直接点光源的情况，计算**入射辐射亮度 radiance**，即 $\,L_i(p, \omega_i)\,$，先获取光源的颜色值，然后按照光源和某点 $\,p\,$ 的距离进行衰减，接着按照 $\,n \cdot \omega_i\,$ 缩放，写成代码如下：  

    vec3  lightColor  = vec3(r, g, b);
    vec3  wi          = normalize(lightPos - fragPos);
    float cosTheta    = max(dot(N, Wi), 0.0);
    float attenuation = calculateAttenuation(fragPos, lightPos);
    float radiance    = lightColor * attenuation * cosTheta;

> 这里 NdotL 若在 radiance 里乘了，就不要在运用反射方程的时候再乘一次了。我对颜色的理解是，辐射通量可以用颜色 RGB 表示，我们要计算的 radiance 是单位立体角单位接受面积的辐射通量。因为辐射强度，即单位立体角辐射通量，不会产生衰减，无论我们从哪个角度观察点光源，它总具有相同的辐射强度，我们可以有效地将其辐射强度建模为其辐射通量，即 RGB 颜色常量。真正的光线衰减产生自辐射照度 Irradiance，即单位接受面积辐射通量，若忘了详见《GAMES101-图形学入门公开课笔记（二）》第十四课 Ray Tracing II 中的辐射度量学。所以在计算 radiance 需要考虑颜色在距离上的衰减。

若场景中有多个光源，为了满足反射率方程，我们只需要循环遍历每一个光源，计算他们各自的辐射亮度然后求和，接着根据 BRDF 和光源的入射角和法线夹角进行缩放即可。我们不需要去尝试去求解对于表面的半球领域 $\,\Omega\,$ 的积分。而当我们之后把**环境照明 IBL** 也考虑在内，就必须采取积分去计算了，这是因为光线可能会在任何一个方向入射。

## IBL 简介
在真实世界中，光要么直接来自光源，要么间接来自环境中经过多次弹射后的光（会被部分吸收）。这些物体周围的环境可以被视为一个光源，**图像 Images** 或者**立方体贴图 Cubemap** 可以有效地捕捉**环境光照 Environment light**，这就被称为**基于图像的光照 Image Based Lighting (IBL)** 或**间接光照 Indirect Lighting**。