---
title: 环境光遮蔽（一）之 SSAO 与 HBAO
date: 2025-08-01 12:54:23
categories: 
  - [图形学]
  - [unity, pipeline]
tags:
  - 图形学
  - 游戏开发
  - unity
top_img: /images/black.jpg
cover: https://s2.loli.net/2025/08/01/287gfDiMYRFrmUs.gif
mathjax: true
description: XXXXXXXXXXXXXXXXXXXXXX
---

> 终于要进入**全局光照 Global Illumination** 的领域了，之前 YPipeline 能够使用的全局光照技术基本只有 **IBL** 和 **Light Map**。Unity 的 Progressive Lightmapper 在离线烘焙 Light Map 时理论上应该隐式地包含了因遮挡导致的环境光减弱的 AO 效果，所以若使用了 Light Map 是不需要使用 SSAO 的，而且 Progressive Lightmapper 也提供了 AO 的烘焙，可以额外开启加强 AO 效果。但是若只使用 IBL，即 Light Probe，它只为场景添加了一个整体的颜色或者均匀的光照，但是没有考虑因遮挡导致的暗处或光线衰减，所以整体呈现的效果会让玩家在一定程度上感到不真实或不可信。而**环境光遮蔽 Ambient Occlusion (AO)** 通过描绘物体之间由于遮挡而产生的阴影可以更好地增强场景的可信度和立体感，是一个非常不错的补充 IBL 环境光的方式。IBL + SSAO 的组合可以说是一种非常廉价的全局光照效果，一般来说对于小作坊的简陋的 3D 游戏来说已经足够了。  
> 
> 其实我原来并不想先补充学习屏幕空间环境光遮蔽相关技术，想直接一步到位进入 SSGI 的学习，但是我后来看到 https://github.com/cdrinmatane/SSRT3 实现的 SSGI 借鉴了 GTAO 的思想，实现效果看得我非常心动，所以为了巩固基础，先实现 SSAO 相关算法。

# Ambient Occlusion 介绍
以下内容主要参考了如下资料：  
①《Real-Time Rendering, Fourth Edition》的 Chapter 11 Global Illumination；  
② 寒霜引擎在 SIGGRAPH 2014 的演讲 [Moving Frostbite to Physically Based Rendering 3.0](https://media.contentapi.ea.com/content/dam/eacom/frostbite/files/course-notes-moving-frostbite-to-pbr-v32.pdf 。
) 的 4.10.3 小节 Multi resolution ambient occlusion 。

## 理论基础
**环境光遮蔽 Ambient Occlusion** 最早是由**工业光魔**（又是你乔治卢卡斯）在电影《珍珠港》中为提高计算机生成飞机的环境光照质量所开发的。尽管环境光遮蔽是对光照物理效果进行了很大程度地简化，但是所呈现的效果往往能极大地增加可信度。当光源较为均匀，无法展现物体细节时，这种廉价方法可以提供对于物体形状的视觉暗示。

量化环境光遮蔽的理论背景就是反射方程，相关知识忘了详见[《GAMES101-图形学入门公开课笔记（二）》](https://ybniaobu.github.io/2024/04/23/2024-04-23-GAMES_101_2/)第十四课和第十五课。因为环境光遮蔽估计的是整个半球内的光照可见性，所以要基于表面 irradiance ($\,E\,$) 计算，表面 irradiance 是所有入射 radiance 的余弦加权积分。同时假设所有入射方向 $\,\omega_{i}\,$ 上的 radiance 都是相同且恒定的，这样子计算表面 irradiance，即 $\,E(p)\,$ ，的方程和积分结果如下：  

$$ E(p) = \int_{\Omega} L_i (n \cdot l) dl = \pi L_i $$

上述方程没有考虑可见性问题，在着色点半球范围内的某些方向，可能会被自身物体的其他部分或者是场景中的其他物体所遮挡。为了简单起见，我们假设来自这些遮挡方向上的入射 radiance 为零，这个假设忽略了场景中可能会被其他物体反弹，并最终从这些遮挡方向到达点 p 的光线，但是它极大地简化了推理过程。基于上述假设，补充可见性后，可以得到下述方程：  

$$ E(p) = L_i \int_{\Omega} v(p) (n \cdot l) dl = k_{AO}(p) \pi L_i $$

$\,v(p)\,$ 是一个可见性函数，如果从点 p 向方向 l 投射的光线会被物体遮挡，则该函数值为 0，反之为 1。而 $\,k_{AO}(p)\,$ 则为**环境遮挡系数**，它的范围位于 \[0, 1\] 内，根据上述公式，环境遮挡系数可以被量化为：  

$$ k_{AO}(p) = \cfrac{1}{\pi} \int_{\Omega} v(p) (n \cdot l) dl $$




## 在材质中的运用


# SSAO
> ①Learn OpenGL 教程中的 SSAO 章节：https://learnopengl.com/Advanced-Lighting/SSAO；  
> ②John Chapman 的博客文章 SSAO Tutorial：http://john-chapman-graphics.blogspot.com/2013/01/ssao-tutorial.html；  
> ③Alex Tardif 的博客文章 SSAO ：https://alextardif.com/SSAO.html；

## 介绍

## 实现

## SSDO

# HBAO