---
title: PBR 理论基础（二）
date: 2024-06-04 15:56:47
categories: 
  - [图形学]
tags:
  - 图形学
  - 游戏开发
top_img: /images/black.jpg
cover: https://s2.loli.net/2024/06/04/nouFeJyYMt179RE.jpg
mathjax: true
description: 本笔记的主要内容有 XXXXXX。
---

> 本篇文章主要参考了毛星云的文章：《基于物理的渲染（PBR）白皮书》。本来有了毛星云的文章不打算自己再另写一篇关于 PBR 理论知识的文章了，但是后来还是决定以自己的语言复述一遍、重新梳理结构，并做出一定的简化，方便自己理解。  
> 
> 之前的《Unity Shader入门精要》读书笔记（五）中也有对 PBR 的介绍，建议结合起来看。
> 
> 推荐一个谷歌的 Filament PBR 白皮书：https://google.github.io/filament/Filament.md.html#materialsystem/diffusebrdf 

# BRDF 模型各项
## Diffuse BRDF
Diffuse BRDF 主要包括以下几种方案：  
①Lambert [1760]  
②Oren Nayar [1994]  
③Simplified Oren-Nayar [2012]  
④Disney Diffuse [2012]（SIGGRAPH 2012 Physically-based shading at Disney）  
⑤Renormalized Disney Diffuse [2014]（SIGGRAPH 2014 Moving Frostbite to Physically Based Rendering）
⑥Gotanda Diffuse [2014]  
⑦PBR diffuse for GGX + Smith [2017]（GDC 2017 PBR Diffuse Lighting for GGX + Smith Microsurfaces）  
⑧MultiScattrering Diffuse BRDF [2018]（SIGGRAPH 2018 Material Advances in Call of Duty: WWII）  

我看了几篇知乎的文章，都比较推荐寒霜的 **Renormalized Disney Diffuse**：https://media.contentapi.ea.com/content/dam/eacom/frostbite/files/course-notes-moving-frostbite-to-pbr-v32.pdf ；https://www.ea.com/frostbite/news/moving-frostbite-to-pb

Renormalized Disney Diffuse 主要对 Disney(Burley) Diffuse 模型进行了改进，根据视角入射角对 Diffuse 进行补正来维持能量守恒，代码如下（没有乘 DiffuseColor 以及除以 π）：  

    float Fr_DisneyDiffuse (float NdotV, float NdotL, float LdotH, float linearRoughness)
    {
        float energyBias = lerp(0, 0.5 , linearRoughness);
        float energyFactor = lerp(1.0, 1.0 / 1.51 , linearRoughness);
        float fd90 = energyBias + 2.0 * LdotH * LdotH * linearRoughness;
        float3 f0 = float3(1.0f, 1.0f, 1.0f);
        float lightScatter = F_Schlick(f0, fd90, NdotL).r;
        float viewScatter = F_Schlick(f0, fd90, NdotV).r;

        return lightScatter * viewScatter * energyFactor ;
    }

    float3 F_Schlick (in float3 f0, in float f90, in float u)
    {
        return f0 + (f90 - f0) * pow (1.f - u , 5.f);
    }


## Specular BRDF
目前最主流的基于物理的镜面反射 BRDF 模型是基于微平面理论 microfacet theory 的 Microfacet Cook-Torrance BRDF。微平面理论即认为微面元的法线 m 等于 l 和 v 的一半，即半角向量 h（忘了就回去看《Unity Shader入门精要》读书笔记（五））。此 Specular BRDF 具有以下形式：

$$ f(l,v) = \cfrac {D(h)F(v,h)G(l,v,h)} {4(n \cdot l)(n \cdot v)} $$

$\,D(h)\,$：法线分布函数 Normal Distribution Function, NDF；$\,F(l, h)\,$: 菲涅尔方程 Fresnel Equation；$\,G(l, v, h)\,$: 几何函数 Geometry Function；分母 $\,4(n·l)(n·v)\,$：校正因子 Correction Factor，作为微观几何的局部空间和整个宏观表面的局部空间之间变换的微平面量的校正。

---

下图为 Specular BRDF 各项的不同模型方案（加粗为主流模型）：  

<div  align="center">  
<img src="https://s2.loli.net/2024/06/06/C5vgPZ1FUusJ8H2.png" width = "100%" height = "100%" alt="图15 - Specular BRDF 的不同模型"/>
</div>

菲涅尔项的 Schlick 的 Fresnel 近似式以及讲过很多次了，就不再提了，接下来详细介绍法线分布项以及几何项。

# Specular D
历史上主流的法线分布函数，按提出时间进行排序，可以总结为：  
①Berry [1923]  
②Beckmann [1963]  
③Phong [1973]  
④Blinn-Phong [1977]  
⑤ABC [1989]  
⑥GGX [2007] / Trowbridge-Reitz [1975]  
⑦Shifted Gamma Distribution，SGD [2012]  
⑧Trowbridge-Reitz（GTR）[2012]  
⑨Student’s T-Distribution , STD [2017]  
⑩Exponential Power Distribution , EPD [2017]  
